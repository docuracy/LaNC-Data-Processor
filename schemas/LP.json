{
	"$schema": "http://json-schema.org/draft/2019-09/schema#",
	"$id": "https://w3id.org/locolligo/schemas/LP.json",

	"description": "This Linked Places JSON schema extends the standard geojson schema as described at https://github.com/LinkedPasts/linked-places-format.",
	"anyOf": [{
		"$ref": "https://w3id.org/locolligo/schemas/geojson.json"
	}],

	"type": "object",
	"definitions": {
		"description": "***TO DO***: Add when, citations, and certainty to definitions and to geometries. Resolve xLP version of citations. Add more examples.",
		"ISO8601": {
			"description": "Any valid ISO 8601 expression. See https://en.wikipedia.org/wiki/ISO_8601#Dates.",
			"example":"1066",
			"type": "string"
		},
		"whenDelimiter": {
			"type": "object",
			"properties": {
				"in": {
					"$ref": "#/definitions/ISO8601"
				},
				"earliest": {
					"$ref": "#/definitions/ISO8601"
				},
				"latest": {
					"$ref": "#/definitions/ISO8601"
				}
			},
			"oneOf": [{
					"required": ["in"]
				},
				{
					"required": ["earliest"]
				},
				{
					"required": ["latest"]
				}
			]
		},
		"when": {
			"type": "object",
			"properties": {
				"timespans": {
					"description": "If end is omitted, the timespan is interpreted as the interval described by the start. See https://github.com/LinkedPasts/linked-places-format#when-required",
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"start": {
								"$ref": "#/definitions/whenDelimiter"
							},
							"end": {
								"$ref": "#/definitions/whenDelimiter"
							}
						}
					},
					"minItems": 1,
					"uniqueItems": true
				},
				"periods": {
					"description": "Might be drawn from http://perio.do/ or http://chronontology.dainst.org/.",
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"description": "Name of a period.",
								"example":"Anglo-Saxon Period, 449-1066",
								"type": "string"
							},
							"uri": {
								"description": "URI defining the period.",
								"example":"periodo:p06c6g3whtg",
								"type": "string",
								"format": "uri"
							}
						},
						"required": ["name", "uri"]
					},
					"minItems": 1,
					"uniqueItems": true
				},
				"label": {
					"description": "Textual summary of the entire 'when' object.",
					"example":"for a century during the Anglo-Saxon period",
					"type": "string"
				},
				"duration": {
					"description": "Valid values are strings with the letter 'P' followed by an integer, followed by one of Y, M, W, or D to indicate years, months, weeks, or days.",
					"example":"P100Y",
					"type": "string",
					"pattern": "^P\\d*[YMWD]$"
				}
			},
			"required": ["timespans"]
		},
		"lang": {
			"description": "Two-letter ISO 639-1 language code of the referenced toponym or other textual element. See https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes.",
			"example":"en",
			"type": "string",
			"pattern": "^[a-z]{2}$"			
		},
		"citations": {
			"description": "This array contains citations for the referenced element. ***TO DISCUSS***: This could be replaced by the CSL-JSON standard as in xLP (see https://citationstyles.org/).",
			"type": "array",
			"items": {
				"type": "object",
				"properties":{
					"label": {
						"description": "Name of the source being cited.",
						"example":"Ye Olde Gazetteer",
						"type": "string"
					},
					"year":{
						"description": "Publication year of the source being cited. ***TO DISCUSS***: Validation pattern limits this to years between 1000 and 2999 - should we allow ancient sources?",
						"example":"1635",
						"type": "string",
						"pattern": "^[12][0-9]{3}$"
					},
					"@id":{
						"description": "URI of the source being cited (may be a URL).",
						"example":"tgn:7011944",
						"type": "string",
						"format": "uri"
					}
				},
				"required": ["label"]
			},
			"minItems": 1,
			"uniqueItems": true
		},
		"placename":{
			"description": "A toponym together with optional citations and temporal scoping.",
			"type": "object",
			"properties": {
				"toponym": {
					"description": "The name of a place.",
					"example": "Abingdon",
					"type": "string",
					"minLength": 1
				},
				"lang": {
					"$ref": "#/definitions/lang"
				},
				"citations":{
					"$ref": "#/definitions/citations"
				},
				"when":{
					"$ref": "#/definitions/when"
				}
			},
			"required": ["toponym"]
		}
	},
	"properties": {
		"type": {
			"enum": ["FeatureCollection"]
		},
		"@context": {
			"description": "URL of context document",
			"example":"https://w3id.org/locolligo/contexts/linkedplaces.jsonld",
			"type": "string",
			"format": "uri",
			"pattern": "^https?://"
		},
		"features": {
			"description": "This array contains the primary subjects of the dataset. They will usually be geolocated, but this is optional.",
			"type": "array",
			"items": {
				"type": "object",
				"properties": {
					"properties": {
						"type": "object",
						"properties": {
							"title": {
								"description": "A label for the record, usually a 'preferred name' from among the toponyms associated with a place.",
								"example":"Abingdon (UK)",
								"type": "string",
								"minLength": 1
							},
							"ccodes": {
								"description": "An array of one or more two-letter codes (ISO 3166-1 alpha-2) indicating modern countries whose bounds contains or overlap the place.",
								"example":["GB"],
								"type": "array",
								"items": {
									"type": "string",
									"pattern": "^[A-Z]{2}$"
								},
								"minItems": 1,
								"uniqueItems": true
							}
						},
						"required": ["title"]
					},
					"when": {
						"$ref": "#/definitions/when"
					},
					"names": {
						"description": "An array of one or more attested toponyms. ***TO DISCUSS***: LP standard requires at least the first toponym to have a citation, and for at least one citation to have a year. This might be considered too restrictive, especially for xLP use cases, and has not (yet) been implemented in this schema.",
						"type": "array",
						"items": {
							"$ref": "#/definitions/placename"
						},
						"minItems": 1,
						"uniqueItems": true
					},
					"types": {
						"description": "***TO DO***"
					},
					"links": {
						"description": "***TO DO***"
					},
					"relations": {
						"description": "***TO DO***"
					},
					"descriptions": {
						"description": "***TO DO***"
					},
					"depictions": {
						"description": "***TO DO***"
					}
				},
				"required": ["@id", "properties","names","geometry"]
			},
			"minItems": 1,
			"uniqueItems": true
		}
	},
	"allOf": [{
			"required": ["type", "@context", "features"]
		},
		{
			"description": "***TO DO / DISCUSS***: Standard LP specification *requires* a 'when' property to to temporally scope a) an entire Feature; b) a name; c) a geometry (representative point or extent); d) a type; or e) a relation.",
			"anyOf": [{}]
		}
	]
}
